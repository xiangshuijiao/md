* [能<strong>上网查到</strong>的就不要记了](#%E8%83%BD%E4%B8%8A%E7%BD%91%E6%9F%A5%E5%88%B0%E7%9A%84%E5%B0%B1%E4%B8%8D%E8%A6%81%E8%AE%B0%E4%BA%86)
* [杂项](#%E6%9D%82%E9%A1%B9)
  * [书签备份](#%E4%B9%A6%E7%AD%BE%E5%A4%87%E4%BB%BD)
  * [VMware虚拟机](#vmware%E8%99%9A%E6%8B%9F%E6%9C%BA)
  * [tmux使用手册](#tmux%E4%BD%BF%E7%94%A8%E6%89%8B%E5%86%8C)
  * [securecrt配置](#securecrt%E9%85%8D%E7%BD%AE)
  * [excel绘图](#excel%E7%BB%98%E5%9B%BE)
  * [git手册](#git%E6%89%8B%E5%86%8C)
  * [vim配置文件](#vim%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6)
  * [typora配置文件](#typora%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6)
  * [python转exe](#python%E8%BD%ACexe)
  * [小米手环模拟加密的门禁等IC卡的教程](#%E5%B0%8F%E7%B1%B3%E6%89%8B%E7%8E%AF%E6%A8%A1%E6%8B%9F%E5%8A%A0%E5%AF%86%E7%9A%84%E9%97%A8%E7%A6%81%E7%AD%89ic%E5%8D%A1%E7%9A%84%E6%95%99%E7%A8%8B)
* [Windows](#windows)
  * [Win10离线安装\.NET Framework 3\.5的方法技巧](#win10%E7%A6%BB%E7%BA%BF%E5%AE%89%E8%A3%85net-framework-35%E7%9A%84%E6%96%B9%E6%B3%95%E6%8A%80%E5%B7%A7)
* [Ubuntu](#ubuntu)
  * [其他](#%E5%85%B6%E4%BB%96)
  * [samba图形化界面配置](#samba%E5%9B%BE%E5%BD%A2%E5%8C%96%E7%95%8C%E9%9D%A2%E9%85%8D%E7%BD%AE)
  * [ubuntu中文路径改为英文](#ubuntu%E4%B8%AD%E6%96%87%E8%B7%AF%E5%BE%84%E6%94%B9%E4%B8%BA%E8%8B%B1%E6%96%87)
  * [Ubuntu1604源码安装wireshak最新版3\.0\.7](#ubuntu1604%E6%BA%90%E7%A0%81%E5%AE%89%E8%A3%85wireshak%E6%9C%80%E6%96%B0%E7%89%88307)
  * [ubuntu开启混杂模式后用wireshark抓包](#ubuntu%E5%BC%80%E5%90%AF%E6%B7%B7%E6%9D%82%E6%A8%A1%E5%BC%8F%E5%90%8E%E7%94%A8wireshark%E6%8A%93%E5%8C%85)
* [翻墙](#%E7%BF%BB%E5%A2%99)
  * [v2ray](#v2ray)
  * [谷歌镜像搭建](#%E8%B0%B7%E6%AD%8C%E9%95%9C%E5%83%8F%E6%90%AD%E5%BB%BA)
* [搭建公司测试拓扑](#%E6%90%AD%E5%BB%BA%E5%85%AC%E5%8F%B8%E6%B5%8B%E8%AF%95%E6%8B%93%E6%89%91)
  * [测试拓扑搭建教程](#%E6%B5%8B%E8%AF%95%E6%8B%93%E6%89%91%E6%90%AD%E5%BB%BA%E6%95%99%E7%A8%8B)
    * [相关知识](#%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86)
    * [DNS](#dns)
    * [DHCP](#dhcp)
    * [PPPOE](#pppoe)
    * [dibbler\-server、radvd](#dibbler-serverradvd)
    * [PPPOEv6](#pppoev6)
    * [转发功能](#%E8%BD%AC%E5%8F%91%E5%8A%9F%E8%83%BD)
    * [wireshak](#wireshak)
    * [flameshot](#flameshot)
    * [BaiduPCS\-Go](#baidupcs-go)
    * [静态IP](#%E9%9D%99%E6%80%81ip)
  * [配置文件](#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6)
    * [静态IP、DNS](#%E9%9D%99%E6%80%81ipdns)
    * [dns 配置文件](#dns-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6)
    * [dhcp配置文件](#dhcp%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6)
    * [radvd配置文件](#radvd%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6)
    * [dibbler配置文件](#dibbler%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6)
    * [pppoe配置文件](#pppoe%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6)
    * [pppoev6配置文件](#pppoev6%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6)
  * [测试](#%E6%B5%8B%E8%AF%95)
  * [踩的坑](#%E8%B8%A9%E7%9A%84%E5%9D%91)
    * [glibc升级](#glibc%E5%8D%87%E7%BA%A7)
    * [dibbler启动](#dibbler%E5%90%AF%E5%8A%A8)
  * [问题](#%E9%97%AE%E9%A2%98)
    * [网关上的ipv6路由表要自己搭建](#%E7%BD%91%E5%85%B3%E4%B8%8A%E7%9A%84ipv6%E8%B7%AF%E7%94%B1%E8%A1%A8%E8%A6%81%E8%87%AA%E5%B7%B1%E6%90%AD%E5%BB%BA)
    * [pppoe拨号获取ipv6相关信息失败](#pppoe%E6%8B%A8%E5%8F%B7%E8%8E%B7%E5%8F%96ipv6%E7%9B%B8%E5%85%B3%E4%BF%A1%E6%81%AF%E5%A4%B1%E8%B4%A5)
    * [Dynamic拨号获取ipv6相关信息失败](#dynamic%E6%8B%A8%E5%8F%B7%E8%8E%B7%E5%8F%96ipv6%E7%9B%B8%E5%85%B3%E4%BF%A1%E6%81%AF%E5%A4%B1%E8%B4%A5)


Created by [gh-md-toc](https://github.com/ekalinin/github-markdown-toc.go) 

### 能**上网查到**的就不要记了

### 杂项

#### 书签备份

* [bookmarks_2019_12_7.7z](https://www.lanzous.com/i7vu99g)

* 


#### VMware虚拟机

* [VMware虚拟机扩展Linux根目录磁盘空间（Centos）](https://my.oschina.net/u/876354/blog/967848)
* 虚拟机linux设置静态IP
  - [Linux重启网卡报错：Bringing up interface eth0:1...... - 弗兰-随风小欢的博客 - CSDN博客](https://blog.csdn.net/qq_32575047/article/details/78896534)
  - [Linux虚拟机设置静态IP - Baishu的专栏 - CSDN博客](https://blog.csdn.net/sinat_32660629/article/details/80080880)

#### tmux使用手册

* [Tmux使用手册]([http://louiszhai.github.io/2017/09/30/tmux/#Tmux%E5%BF%AB%E6%8D%B7%E6%8C%87%E4%BB%A4](http://louiszhai.github.io/2017/09/30/tmux/#Tmux快捷指令))
* [Tmux 快捷键 & 速查表 & 简明教程](https://gist.github.com/ryerh/14b7c24dfd623ef8edc7)

#### securecrt配置

* 导出日志，行数无限制

- [SecureCRT配置屏幕内容输出到log文件 - quietly_brilliant的专栏 - CSDN博客](https://blog.csdn.net/quietly_brilliant/article/details/78125599)
- [10个提升工作效率的Secure CRT小窍门 - 你玩转了几个？-sandshell-51CTO博客](https://blog.51cto.com/sandshell/2118024)

#### excel绘图

* [通过Excel2003图表工具栏创建图表](http://www.excelcn.com/jiaocheng/excel2003/376.html)

#### git手册

* [常用 Git 命令清单](https://www.ruanyifeng.com/blog/2015/12/git-cheat-sheet.html)

#### vim配置文件

```shell
filetype on
filetype indent on
set autoindent
set smartindent
set tabstop=4
set noexpandtab
set shiftwidth=4
set nu
syntax on
inoremap { {}<ESC>i<CR><ESC>ko

nnoremap <silent> [b :bprevious<CR>
nnoremap <silent> ]b :bnext<CR>
nnoremap <silent> [B :bfisrt<CR>
nnoremap <silent> ]B :blast<CR>
```

#### typora配置文件

```c
/* 打开偏好设置 -> 打开主题文件夹 -> 新建 github.user.css 文件，填入如下内容。 */
/* 调整视图正文宽度 */
#write{
    max-width: 90%;
}
/* 调整源码正文宽度 */
#typora-source .CodeMirror-lines {
    max-width: 90%;
}
/* 调整输出 PDF 文件宽度 */
@media print {
    #write{
        max-width: 95%;
    }
    @page {
        size: A3;
    }
}
/* 调整正文字体,字体需单独下载 */
body {
    font-family: IBM Plex Sans;
}
```

#### python转exe

* [简单3步将你的python转成exe格式](https://zhuanlan.zhihu.com/p/38659588)

#### 小米手环模拟加密的门禁等IC卡的教程

* 需要购买**259元的proxmark3**
* [手把手教 如何模拟IC加密卡](https://zhuanlan.zhihu.com/p/81384126)
* [小米手环4nfc版提示“不支模拟该类型卡”的解决方案](https://www.bilibili.com/read/cv3417983/)

### Windows

#### Win10离线安装.NET Framework 3.5的方法技巧

* 下载window10的iso文件

* Win10 ISO文件上点击右键，选择“装载”，记下装载的盘符G，下面的命令会用到

* 以管理员权限执行下面的命令，[参考链接](https://www.windows10.pro/win10-net-framework-3-5/)

  ```shell
  dism.exe /online /enable-feature /featurename:netfx3 /Source:G:\sources\sxs
  ```

### Ubuntu

#### 其他

* [Ubuntu16.04默认make版本修改（make-3.82）](https://blog.csdn.net/sjzzdf123/article/details/79863548)

#### samba图形化界面配置

* ```powershell
  apt install samba samba-common smbfs cifs-utils system-config-samba
  system-config-samba  # 选择access--》allow access to everyone
  setfacl -R -m u:nobody:rwx /home/mobile/Desktop/ # 给所有用户读写执行权限
  ```

#### ubuntu中文路径改为英文

* 在**普通模式**下执行以下命令

* ```makefile
  # 注意：不要在管理员模式下执行命令
  export LANG=en_US
  xdg-user-dirs-gtk-update
  reboot
  ```

#### Ubuntu1604源码安装wireshak最新版3.0.7

* [Ubuntu源码安装wireshark](https://blog.csdn.net/weixin_40850689/article/details/93466848)

* [Wireshark3.0 ubuntu16.04上编译](https://blog.csdn.net/cjqqschoolqq/article/details/89737648)

* 安装步骤

  * [下载源码：wireshark-master-3.0.zip](https://www.lanzous.com/i7kvtpc)
  
    ```shell
    wget -c http://download.qt-project.org/archive/qt/5.11/5.11.2/qt-opensource-linux-x64-5.11.2.run # 下载qt5.11.2
    # 安装工具包
    sudo apt-get install libglib2.0-dev
    sudo apt-get install libgcrypt20-dev
    sudo apt-get install flex bison
    sudo apt-get install libssh-dev
    sudo apt-get install libpcap-dev
    sudo apt-get install libssh-dev
    sudo apt-get install libsystemd-dev
    sudo apt-get install qmake-qt-gui
    sudo apt-get install libgl1-mesa-dev libglu1-mesa-dev freeglut3-dev
    
    chmod 777 qt-opensource-linux-x64-5.11.2.run && ./qt-opensource-linux-x64-5.11.2.run # 除了两个android不要选，其他都选上。 
    mkdir build && cd build 
    export CMAKE_PREFIX_PATH="/opt/Qt5.11.2/5.11.2/gcc_64/lib/cmake/Qt5Core:/opt/Qt5.11.2/5.11.2/gcc_64/lib/cmake/Qt5LinguistTools:/opt/Qt5.11.2/5.11.2/gcc_64/lib/cmake/Qt5Multimedia:/opt/Qt5.11.2/5.11.2/gcc_64/lib/cmake/Qt5PrintSupport:/opt/Qt5.11.2/5.11.2/gcc_64/lib/cmake/Qt5Svg"
    
    cmake -G "Unix Makefiles" ../wireshark-master-3.0/  # 注意：**如果已经进入了管理员模式就不要在使用sudo了，否则上一步的环境变量不会生效。**
    make && make install
    sudo wireshark
    ```

#### ubuntu开启混杂模式后用wireshark抓包

* [使用Aircrack-ng套件在5Ghz无线网频段](https://blog.csdn.net/CK2009159/article/details/84096343)
  
  ```shell
  service network-manager stop # 彻底关闭网络模块，防止开了混杂模式后一连网又退出混杂模式了
  # 将网卡设置为混杂监听模式
  ifconfig wlan0 down
  iwconfig wlan0 mode monitor ## 可以用iw list 查看网卡是否支持monitor模式
  ifconfig wlan0 up
  apt install aircrack-ng
  # 设置无线网卡既抓取2.4G的帧，也抓取5G的帧
  airodump-ng wlan0 --bssid ff:ff:ff:ff:ff:ff -C 2400-5900 
  # wireshark筛选出2.4G和5G的beacon帧。
  wlan.fc.type==0x00 && wlan.fc.type_subtype==0x08 && (wlan.addr==00:12:23:38:38:38 || wlan.addr==00:12:23:38:38:399) 
  ```

### 翻墙

#### v2ray

* [V2Ray搭建详细图文教程](https://github.com/233boy/v2ray/wiki/V2Ray搭建详细图文教程)
* [BBR安装教程：Debian9、CentOS](https://fangeqiang.com/2012.html)
* [v2ray免费账号·Alvin9999 / new-pac Wiki·GitHub](https://github.com/Alvin9999/new-pac/wiki/v2ray免费账号)
* 端口检测：http://coolaf.com/tool/port
* 端口打开命令 

#### 谷歌镜像搭建

* [搭建Google 反代站（镜像站）隐藏真实 IP ，轻轻松松上谷歌](https://www.madapang.com/technology/google-ghost.html)

* [更改nginx默认端口,**重启nginx报错**](https://blog.csdn.net/w20101310/article/details/78835668)

* [2019/2020 Google镜像大全，谷歌镜像网址](https://www.uedbox.com/post/54776/)

* **注意**：只能使用http，https会访问失败

* /usr/local/nginx/conf/nginx.conf配置文件如下：

* ```makefile
  user nobody nobody;
  worker_processes auto;
  error_log logs/error.log crit;
  
  pid logs/nginx.pid;
  
  #Specifies the value for maximum file descriptors that can be opened by this process.
  worker_rlimit_nofile 51200;
  
  events
  {
      use epoll;
      worker_connections 51200;
  }
  
  http
  {
      include mime.types;
      default_type application/octet-stream;
      server_tokens off;
      server_names_hash_bucket_size 128;
      client_header_buffer_size 32k;
      large_client_header_buffers 4 32k;
      client_max_body_size 8m;
  
      sendfile on;
      tcp_nopush on;
      keepalive_timeout 30;
      tcp_nodelay on;
  
      gzip on;
      gzip_min_length 1k;
      gzip_buffers 4 16k;
      gzip_http_version 1.0;
      gzip_comp_level 2;
      gzip_types text/plain application/x-javascript text/css application/xml;
      gzip_vary on;
      #limit_zone crawler $binary_remote_addr 10m;
      log_format default '$remote_addr - $remote_user [$time_local] "$request" '
          '$status $body_bytes_sent "$http_referer" '
          '"$http_user_agent" -- "$http_cookie" $http_x_forwarded_for "$proxy_add_x_forwarded_for" "$request_time"';
  
      server {
          listen       8089;
          server_name www.huozhebusi.xyz;
  
          location / {
              proxy_pass https://www.google.com/;
  
              proxy_redirect https://www.google.com/ /;
              proxy_cookie_domain google.com www.huozhebusi.xyz;
  
              proxy_set_header User-Agent $http_user_agent;
              proxy_set_header Cookie "PREF=ID=047808f19f6de346:U=0f62f33dd8549d11:FF=2:LD=zh-CN:NW=1:TM=1325338577:LM=1332142444:GM=1:SG=2:S=rE0SyJh2W1IQ-Maw";
              # 这里设置cookie，这里是别人给出的一段，必要时请放上适合你自己的cookie
              # 设置这个可以避免一些情况下的302跳转，如果google服务器返回302 redirect，那么浏览器被跳转到google自己的域名，那就没的玩了
  
              proxy_set_header X-Real-IP $remote_addr;
              proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
  
              # subs_filter  http://www.google.com http://www.huozhebusi.xyz;
              # subs_filter  https://www.google.com http://www.huozhebusi.xyz;
              # 这里替换网页中的链接，因为我们的镜像站是http的，所以上面顺便把协议也一起替换了
      }
      }
  }
  ```

### 搭建公司测试拓扑

#### 测试拓扑搭建教程

##### 相关知识

* host www.debian.cn 192.168.23.179  指定域名服务器，正向查询

* host 192.168.23.179  192.168.23.179 指定域名服务器，反向查询

* ufw disable 关闭防火墙

* netstat -uap查看本机运行的服务

* vim /var/log/syslog 查看系统日志，会有各种服务器启动失败的原因

* 开机执行脚本 **/etc/rc.local**

* killall 进程名，kill 进程PID

* [linux中grep命令的用法：如何使用正则表达式筛选](https://www.cnblogs.com/flyor/p/6411140.html)

* [Linux（Ubuntu 16.04）搭建ftp服务器](https://blog.csdn.net/null_qiao/article/details/76919234)

* [ubuntu登录自动运行脚本(解决root权限问题)](https://blog.csdn.net/mao0514/article/details/55094615)

* [Ubuntu全盘备份与恢复，亲自总结，实测可靠](https://blog.csdn.net/sinat_27554409/article/details/78227496)

  * 将下面的脚本拷贝到/backup文件夹并执行
  * [ubuntu 系统备份和还原策略](https://github.com/hayifeng/Just_For_Fun/issues/7)：备份到最后系统会提示`tar: 由于前次错误,将以上次的错误状态退出`，这个警告可以忽略，没什么影响的。
  
  ```makefile
  echo $(date)
  cd /
  tar cvpzf /backup/`date +%Y%m%d%H%M`.tgz --exclude=/proc --exclude=/lost+found --exclude=/backup --exclude=/mnt --exclude=/tmp --exclude=/media /
  echo $(date)
  ```
##### wireshak

* [Ubuntu源码安装wireshark](https://blog.csdn.net/weixin_40850689/article/details/93466848)：/etc/sysctl.conf
* [Wireshark3.0 ubuntu16.04上编译](https://blog.csdn.net/cjqqschoolqq/article/details/89737648)

##### flameshot

* 注意：不能在管理员模式下使用flameshot gui启动flameshot，只能在普通模式下启动;
* [ubuntu1604 安装截图粘图工具flameshot并设置快捷键为F3](https://blog.csdn.net/weixin_42927959/article/details/95375941) ;
* [qmake报错：Project ERROR: Unknown module(s) in QT: svg](https://blog.csdn.net/qq_21398167/article/details/46427597)

##### BaiduPCS-Go

* **github搜索百度网盘按日期排序，最近更新过的项目肯定是能用的**（百度云用于关键词搜索）。

* [BaiduPCS-Go的安装及使用](https://luomuxiaoxiao.com/?p=102)

* [百度网盘客户端 - Go语言编写]([https://github.com/iikira/BaiduPCS-Go#%E4%B8%8B%E8%BD%BD%E6%96%87%E4%BB%B6%E7%9B%AE%E5%BD%95](https://github.com/iikira/BaiduPCS-Go#下载文件目录))

* BaiduPCS-Go locate <文件1> <文件2> 获取下载直链

* d --share  --locate  -p 100 文件**支持自动断点续传，所以下载卡住了可以重新下载**

* **BaiduPCS-Go登录不上**

  * 错误代码: 50035, 消息: 系统繁忙，请稍候再试(50035)
  * 换种登录方式即可，`BaiduPCS-Go login -bduss=`

  * [GitHub issue中有BDUSS获取方式](https://github.com/iikira/BaiduPCS-Go/wiki/%E5%85%B3%E4%BA%8E-%E8%8E%B7%E5%8F%96%E7%99%BE%E5%BA%A6-BDUSS)


##### DNS

* [Linux系统下搭建DNS服务器——DNS原理总结](https://zhuanlan.zhihu.com/p/31568450)
* [Ubuntu采用bind9配置DNS服务器](https://blog.csdn.net/colourzjs/article/details/44491479)
* [DNS记录类型介绍(A记录、MX记录、NS记录等)](https://blog.csdn.net/tvk872/article/details/80683480)
* [[DNS]ubuntu搭建DNS服务器（bind9）- IPv6](https://blog.csdn.net/u012503786/article/details/86579178)
* [localhost 127.0.0.1 127.1 本地回送IP地址](https://zhidao.baidu.com/question/120305135.html)
* [bind配置工具rndc使用](https://www.jianshu.com/p/f08cf7cebf3f)
* 最终可用的配置：
  * [DNS软件bind使用（一）](https://blog.51cto.com/cuchadanfan/1710387)
  * [Debian 环境下简单配置 Bind9 服务](https://cloud.tencent.com/developer/article/1374805)

##### DHCP

* [Ubuntu-16.04搭建DHCP服务](https://blog.51cto.com/tong707/2124716)
* [Ubuntu 14.04 isc-dhcp-server 启动失败(no IPv4 addresses)问题解决方法](https://blog.csdn.net/yingang_fu/article/details/39400845)


##### PPPOE

* VlanID：局端会剥去从样机过来的VlanID为35的头部，从局端出来的所有的数据都没有VlanID，所以服务器不需要划分VlanID，下面的四个网页看看就好，用不到的。

  * [单lan PPPoE服务器，多lan PPPoE服务器，VLAN PPPoE服务器搭建](https://en.ikuai8.com/support_article.php?id=0000000732)
  * [搭建网关系列 —— VLAN篇](https://onebitbug.me/2014/05/28/building-a-gateway-vlan/)
  * [Ubuntu上建立PPPoE server,并使用VLAN，用于常用双VLAN测试](http://blog.chinaunix.net/uid-22490342-id-3405506.html)
  * [LINUX (UBUNTU) 双网卡多VLAN的Server 配置](https://blog.51cto.com/jingshengsun888/1265947)

* 最终使用

  * [基于Linux环境的PPPOE服务器搭建](https://zhuanlan.zhihu.com/p/41499761)

  * ```makefile
    pppoe-server -I enp1s0  -L 192.168.5.1 -R 192.168.5.3 -N 200
    ```

##### dibbler-server、radvd

* 内网：培训时李伟杰的ppt、Ubuntu下测试环境搭建doc

* 虽然无状态拨号用不到ICMPV6交互，但是还是要安装radvd并配置启动，因为不仅仅无状态拨号用到了ICMPV6交互，NDP邻居发现协议、DVD重复地址检测都用到了ICMPv6，如果不配置radvd可能就会获取不到网关等信息。

* 配置dibbler-server后进行DHCPV6有状态dynamic拨号时如果发现DNS获取失败、LAN前缀获取失败，那就:

  * 没有DNS、网关就重启radvd
  * 没有ip就重启dibbler-server
  * 重启服务器、路由器、换一个样机再试试。我最开始使用的样机出现了上面的问题导致我以为我自己的配置文件写的有问题，然后在这个上面耗费了很长的一段时间，后来也怀疑过是样机的问题，但是换了几个样机后ipv6的dynamic拨号仍旧会出现上面的问题，最后碰巧使用了晓龙的样机居然没有任何的问题，感觉前面花费的时间都白费了。

* ping服务器时服务器收到了icmpv6报文却不进行回复，这时需要配置路由表，配置命令如下：

  ```makefile
  ip -6 route add 2001::/50 via fe80::4216:9fff:feaa:bb3a dev enp1s0
  ```

  * 2001::/50为dibbler服务器分给DUT样机的LAN口前缀
  * fe80::4216:9fff:feaa:bb3a为DUT wan口的本地链路地址，这里也可以填写dibbler分配給WAN口的全球链路地址，也就是说ipv6的网关既可以是本地链路地址，也可以是全球链路地址。
  * enp1s0为dibbler服务器所在的网卡名，也是DUT wan口直连的服务器网卡名。

##### PPPOEv6

* `/etc/ppp/pppoe-server-options`多一项配置`+ipv6`
* [基于Linux的IPv6接入服务器配置过程](https://wenku.baidu.com/view/12ae3149852458fb770b5684.html)的`PPPoEv6服务器配置`章节中解释了必须配置/etc/ppp/ipv6-up.d脚本的原因。脚本的唯一作用：**`将/etc/radvd.conf和/etc/dibbler/server.conf中的iface网口名enp1s0替换为pppoe服务器启动时新建的网口名ppp0或ppp1或ppp2等，并重启radvd、dibbler-server `**

##### 转发功能

* [ubuntu 双网卡转发网线直接连接配置](https://blog.csdn.net/tiger_he/article/details/80805075): vim /etc/sysctl.conf 
* 参考：[ubuntu双网卡设置内外网上网问题,实现路由转发](https://wenku.baidu.com/view/1920c29b4693daef5ef73df7.html)
* `sysctl -p`全为1表示ipv4、ipv6的转发功能都开启了


##### 静态IP

* 在Ubuntu1404中通过`/etc/network/interfaces`配置ipv4、ipv6地址时ipv4不生效，重启电脑也不行，Ubuntu1604中则没有这个问题，通过反复执行下面的命令可以使配置生效，具体哪个起的作用我也不清楚
  * `ifdown eth0 && ifup eth0 && ifconfig ` **这个命令可能会执行失败，所以需要反复执行，如果能成功执行就能使配置生效**
  * `ifconfig eth0 down up`
  * `/etc/init.d/network restart`
  * `/etc/init.d/network-manager restart`
* **注意：**在``/etc/NetworkManager/system-connections``中的配置信息可能会和`/etc/network/interfaces`中的配置信息冲突，所以最好删除``/etc/NetworkManager/system-connections``中的所有文件，然后重启电脑。

#### 配置文件

##### 静态IP、DNS

* vim /etc/network/interfaces

  ```makefile
  auto lo
  iface lo inet loopback
  
  auto  enp1s0
  iface enp1s0 inet static
          address         192.168.5.1
          netmask         255.255.255.0
          broadcast       192.168.5.255
  #        gateway		10.112.18.254
  #      	 dns-nameservers	10.112.18.1 10.112.18.2  vim  /etc/resolv.conf 
  iface enp1s0 inet6 static
          address         2404:5555::1
          netmask         64
  
  
  auto  enp3s0
  iface enp3s0 inet static
          address         10.0.0.1
          netmask         255.255.255.0
          broadcast       10.0.0.255
  iface enp3s0 inet6 static
          address         2404:0000::1
          netmask         64
  ```

##### dns 配置文件

* vim /etc/bind/named.conf.local

  ```makefile
  zone "debian.cn" {
      type master;
      file "/etc/bind/zones/db.debian.cn";
  };
  
  zone "168.192.in-addr.arpa"  {
      type master;
      file "/etc/bind/zones/db.192.168";
  };
  ```

* vim /etc/bind/zones/db.debian.cn

  ```makefile
  $TTL    604800
  @   IN  SOA debian.cn. admin.debian.cn. (
                    2     ; Serial
               604800     ; Refresh
                86400     ; Retry
              2419200     ; Expire
               604800 )   ; Negative Cache TTL
  ;
  @   IN  NS  ns.debian.cn.
  @   IN  A   192.168.5.2
  ns  IN  A   192.168.5.2
  www IN  A   192.168.5.3
  ipv4 IN A   10.0.0.100
  ipv6  IN  AAAA 2404::100
  proxy IN CNAME @
  blog IN CNAME @
  mysql IN CNAME @
  * IN A 192.168.5.4
  ```
  
* vim /etc/bind/zones/db.192.168 

  ```makefile
  $TTL    604800
  @   IN  SOA debian.cn. admin.debian.cn. (
                    1     ; Serial
               604800     ; Refresh
                86400     ; Retry
              2419200     ; Expire
               604800 )   ; Negative Cache TTL
  ;
  @   IN  NS  ns.debian.cn.
  3.5 IN  PTR www.debian.cn.
  ```

##### dhcp配置文件

* vim /etc/sysctl.conf开启ipv4和ipv6转发，并用sysctl -p检查是否开启成功

  ```makefile
  net.ipv4.ip_forward=1
  net.ipv6.conf.all.forwarding=1
  ```

* vim /etc/default/isc-dhcp-server

  ```makefile
  INTERFACES="enp1s0"
  
  ```

* vim /etc/dhcp/dhcpd.conf

  ```makefile
  #subnet后跟子网网段，netmask后跟子网掩码
  subnet 192.168.5.0 netmask 255.255.255.0 {
          #地址池
          range 192.168.5.3 192.168.5.244;
          #DNS服务器地址(多个地址用","隔开)
          option domain-name-servers 192.168.5.1;
          #为所分配的域分配域名
  #       option domain-name "mylab.com";
          #为所分配的主机分发子网掩码
          option subnet-mask 255.255.255.0;
          #分发默认网关
          option routers 192.168.5.1;
          #分发广播地址
          option broadcast-address 192.168.5.255;
          #默认租期时间(秒)
          default-lease-time 6000000;
          #最大租期时间(秒)
          max-lease-time 72000000;
  }
  ddns-update-style none;
  option domain-name "example.org";
  default-lease-time 600;
  max-lease-time 7200;
  
  ```

  

##### radvd配置文件

* vim /etc/radvd.conf

  ```makefile
  interface enp1s0 {
          MaxRtrAdvInterval 600;
          MinRtrAdvInterval 360;
          IgnoreIfMissing on;
          AdvSendAdvert on;
          AdvOtherConfigFlag off;
          AdvManagedFlag on;
  };
  
  ```

##### dibbler配置文件

* vim /etc/dibbler/server.conf

  ```makefile
  log-level 8
  log-mode short
  preference 100
  
  iface enp1s0 {
           t1 100
           t2 400
           prefered-lifetime 6000000
           valid-lifetime 6000000
  
           class {
             pool 2404:5555::/64
           }
  
           ta-class {
              pool 2004::/64
           }
  
           pd-class {
               pd-pool 2001::/50
               pd-length 64
           }
           option dns-server 2404:5555::1
  }
  
  ```

##### pppoe配置文件

* vim /etc/ppp/options

  ```makefile
  ms-dns 192.168.5.1
  asyncmap 0
  auth
  crtscts
  lock
  hide-password
  modem
  netmask 255.255.255.0
  passive
  -ac
  -pap
  +chap
  debug
  proxyarp
  lcp-echo-interval 30
  lcp-echo-failure 4
  noipx
  
  ```

* vim /etc/ppp/pppoe-server-options

  ```makefile
  require-chap
  lcp-echo-interval 60
  lcp-echo-failure 5
  logfile /var/log/pppd.log
  +ipv6
  
  ```

* vim /etc/ppp/chap-secrets

  ```makefile
  ttt    *    ttt         *
  
  ```

##### pppoev6配置文件

* ```makefile
  /etc/skel/dibbler_server_for_eth.conf
  /etc/skel/dibbler_server_for_pppoe.conf
  配置文件和/etc/dibbler/server.conf相同，只是接口名都换成了IFNAME
  
  /etc/skel/radvd_for_eth.conf
  /etc/skel/radvd_for_pppoe.conf
  配置文件和/etc/radvd.conf相同，只是接口名都换成了IFNAME
  
  ```

* vim /etc/ppp/ipv6-up.d/00radvd

  ```makefile
  #! /bin/bash
  
  CONFSKEL=/etc/skel/radvd_for_pppoe.conf
  CONFREAL=/etc/radvd.conf
  IFNAME="$1"
  
  logger -p user.info  restart radvd on interface $IFNAME
  
  cp "${CONFSKEL}" "${CONFREAL}"
  sed -i "s/IFNAME/${IFNAME}/g" "${CONFREAL}"
  
  service radvd restart
  service radvd restart
  service radvd restart
  
  ip -6 route delete 2001::/50
  ip -6 route add 2001::/50 dev $IFNAME
  
  ```

* vim /etc/ppp/ipv6-up.d/01dibbler

  ```makefile
  #! /bin/bash
  
  CONFSKEL=/etc/skel/dibbler_server_for_pppoe.conf
  CONFREAL=/etc/dibbler/server.conf
  IFNAME="$1"
  
  logger -p user.info restart dibbler-server on interface $IFNAME
  
  service dibbler-server stop
  rm -rf /var/lib/dibbler/*
  
  cp "${CONFSKEL}" "${CONFREAL}"
  sed -i "s/IFNAME/${IFNAME}/g" "${CONFREAL}"
  
  service dibbler-server start
  service dibbler-server restart
  service dibbler-server restart
  service dibbler-server restart
  
  ```

* vim /etc/ppp/ipv6-down.d/00dibbler

  ```makefile
  #! /bin/bash
  
  CONFSKEL=/etc/skel/dibbler_server_for_eth.conf
  CONFREAL=/etc/dibbler/server.conf
  PPPIFNAME="$1"
  ETHIFNAME="enp1s0"
  
  logger -p user.info stop dibbler-server on interface $PPPIFNAME
  
  service dibbler-server stop
  rm -rf /var/lib/dibbler/*
  
  logger -p user.info start dibbler-server on interface $ETHIFNAME
  cp "${CONFSKEL}" "${CONFREAL}"
  sed -i "s/IFNAME/${ETHIFNAME}/g" "${CONFREAL}"
  
  service dibbler-server start
  service dibbler-server restart
  service dibbler-server restart
  service dibbler-server restart
  service dibbler-server restart
  
  ```

* vim /etc/ppp/ipv6-down.d/01radvd

  ```makefile
  #! /bin/bash
  
  CONFSKEL=/etc/skel/radvd_for_eth.conf
  CONFREAL=/etc/radvd.conf
  PPPIFNAME="$1"
  ETHIFNAME="enp1s0"
  
  logger -p user.info  stop radvd on interface $PPPIFNAME
  service radvd stop
  
  cp "${CONFSKEL}" "${CONFREAL}"
  sed -i "s/IFNAME/${ETHIFNAME}/g" "${CONFREAL}"
  
  logger -p user.info  start radvd on interface $ETHIFNAME
  service radvd start
  service radvd start
  service radvd start
  service radvd start
  
  ip -6 route delete 2001::/50
  ip -6 route add 2001::/50 dev enp1s0
  
  
  ```

* 给4个脚本可执行权限

  ```makefile
  chmod 777 -R /etc/ppp/ipv6-up.d/*
  chmod 777 -R /etc/ppp/ipv6-down.d/*
  
  ```

* 开机自启动：`vim /etc/rc.local`

  ```makefile
  pppoe-server -I enp1s0  -L 192.168.5.1 -R 192.168.5.3 -N 200
  ```

* **注意：**因为每次进行pppoe连接时都会新建一个ppp接口，而dibbler-server必须要在指定的ppp接口上启动才可以给该ppp接口连接的DUT样机分配IPV6地址，而上面脚本的作用就是每来一个ppp连接就将dibbler-server的启动接口修改为新建的ppp连接接口，从而给新建的连接分配ipv6地址，但是这样就不能给旧有的ppp连接分配ipv6地址了，所以我采用了以下两点策略：
* 将dibbler-server的地址有效时间修改的长一点，这样旧有的ppp连接有了地址之后的很长一段时间都不用再次获取ipv6地址。
  
  * pppoe拨号获取ipv6失败就反复重拨，因为每次拨号都会将dibbler-server的启动接口修改为新建的ppp接口，同时还会重启dibbler-server服务器。

#### 测试

* sip服务器上已经注册过的电话

  ```c
  101 102 103 104 105
  
  ```

* dns：能ping通`ipv4.debian.cn（10.0.0.100）`和`ipv6.debian.cn(2404::100)`

* http：直接在样机连接的pc的浏览器上输入`10.0.0.100`或者输入对应的域名`ipv4.debian.cn`可以连接到http文件服务器

* acs：直接在样机连接的pc的浏览器上输入`10.0.0.100:8080//login`或者输入对应的域名`ipv4.debian.cn:8080//login`可以连接到acs服务器

* voip：能注册并拨通电话

* chariot：[linux的endpoint下载地址（下载tar压缩包）](https://support.ixiacom.com/support-links/ixchariot/endpoint-library/platform-endpoints)

  * [Ubuntu14.04下Endpoint5.1的安装及使用方法](https://blog.csdn.net/snaking616/article/details/79094171)**注意不要使用这里的安装包，回报错的，使用上面的**。

  * ```makefile
    /usr/local/Ixia/endpoint 1>>/var/local/endpoint.console 2>&1 & 启动endpoint（放/etc/rc.local可以开机自启动）
    cp /usr/local/Ixia/rc2exec.lnx /etc/init.d/endpoint
    ln -fs /etc/rc.d/init.d/endpoint /etc/rc2.d/S81endpoint
    ln -fs /etc/rc.d/init.d/endpoint /etc/rc3.d/S81endpoint
    ln -fs /etc/rc.d/init.d/endpoint /etc/rc6.d/K81endpoint
    
    ```

  * 测试的吞吐量UDP只有5Mbps，TCP也只有56Mbps，不知道为什么，具体有拍照

* 组播IPTV

  * [关于组播IPTV的讲解](https://blog.csdn.net/qq_34228570/article/details/80152133)

* iperf

  * [[网络性能测试工具iperf详细使用图文教程【转载】](https://www.cnblogs.com/yingsong/p/5682080.html)](https://www.cnblogs.com/yingsong/p/5682080.html)


#### 踩的坑

##### glibc升级

* 千万不要升级glibc！！！
* 在源码安装chariot endpoint时提示glibc版本太低，于是升级glibc，然后系统就崩了，再也起不来了，只能找网管重装系统再来一遍，下面的恢复教程都没用。

* [编译升级glibc与修复](https://github.com/levinit/itnotes/wiki/%E7%BC%96%E8%AF%91%E5%8D%87%E7%BA%A7glibc%E4%B8%8E%E4%BF%AE%E5%A4%8D#%E4%BF%AE%E5%A4%8Dglibc)
* [记GLIBC升级失败后的恢复](http://blog.koko.vc/a/33/%E8%AE%B0glibc%E5%8D%87%E7%BA%A7%E5%A4%B1%E8%B4%A5%E5%90%8E%E7%9A%84%E6%81%A2%E5%A4%8D)

##### dibbler启动

* dibbler-server在enp1s0接口上能正常启动分配IP，在进行pppoev6拨号时在ppp接口上启动失败，询问师兄后得知：使用`rm -rf /var/lib/dibbler/*`将原来的配置信息给清除掉就可以了

#### 问题

##### 网关上的ipv6路由表要自己搭建

##### pppoe拨号获取ipv6相关信息失败

* 解决1：反复几次重新拨号或者干脆删掉连接后重新建立连接。
* 解决2：使用串口查看自己的ppp接口名，然后在服务器上将radvd、dibbler的启动接口修改为自己的ppp接口并重启。
* 原因说明：因为每次pppoe拨号启动时都会将dibbler-server的启动接口修改为新建的ppp接口并重启dibbler-server服务器，而每次pppoe拨号断开时会将dibbler-server的启动接口修改为enp1s0接口并重启dibbler-server服务器，如果pppoe拨号获取ipv6失败就反复几次重新拨号或者干脆删掉连接后重新建立连接，因为dibbler-server服务器有小概率会启动失败，而每次拨号都会重启dibbler-server服务器

##### Dynamic拨号获取ipv6相关信息失败

* 解决1：新建一个pppoe拨号并删除，然后在进行Dynamic拨号。
* 解决2：使用串口查看自己的ppp接口名，然后在服务器上将radvd、dibbler的启动接口修改为自己的ppp接口并重启。
* 原因说明：因为每次pppoe拨号启动时都会将dibbler-server的启动接口修改为新建的ppp接口并重启dibbler-server服务器，而每次pppoe拨号断开时会将dibbler-server的启动接口修改为enp1s0接口并重启dibbler-server服务器，如果Dynamic拨号获取ipv6失败就先新建一个pppoe拨号并删除，然后在进行Dynamic拨号即可获取ipv6地址，因为每次pppoe拨号断开时会将dibbler-server的启动接口修改为enp1s0接口并重启dibbler-server服务器。

